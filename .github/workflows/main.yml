name: Run Script Hourly
on:
  schedule:
    - cron: '0 * * * *' # Every hour
  workflow_dispatch:
jobs:
  run-script:
    runs-on: ubuntu-latest
    env:
      PYTHONDONTWRITEBYTECODE: 1
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        
      # Setup Python and Cache/Install dependencies in one consolidated block
      - name: Setup Python and Install dependencies
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          # This enables built-in caching for pip dependencies
          cache: 'pip' 

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Prepare and Run the script in a single step
      - name: Execute Script
        run: |
          chmod +x run.sh
          ./run.sh

      # Push changes, streamlined
      - name: Commit and Push Changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@users.noreply.github.com"
          
          git add .
          if ! git diff-index --quiet HEAD; then
            git commit -m "Auto-commit: $(date +'%Y-%m-%d %H:%M:%S')"
            git push
          else
            echo "No changes to commit. Skipping push."
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
